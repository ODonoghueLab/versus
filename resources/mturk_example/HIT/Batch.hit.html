<!-- Bootstrap v3.0.3 -->
<link href="https://s3.amazonaws.com/mturk-public/bs30/css/bootstrap.min.css" rel="stylesheet" /><script src="https://code.jquery.com/jquery-1.10.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.0.0/imagesloaded.pkgd.min.js"></script>
<section class="container" id="Other" style="margin-bottom:15px; padding: 10px 10px; font-family: Verdana, Geneva, sans-serif; color:#333333; font-size:0.9em;">
<div class="row col-xs-12 col-md-12"><!-- Instructions -->
<div class="panel panel-primary">
<div class="panel-heading"><strong>Instructions</strong></div>

<div class="panel-body">
<!-- <p><b>Please do not submit this HIT if you have completed an identical HIT previously!</b></p> -->

<p>Thank you for participating in this study. Below you will find 66 Cartesian and Parallel coordinate systems in random order, each showing three points (lines) labelled A, B, and C in up to four dimensions. For each, please choose the point <b><font color="#d95f02">B</font></b> or <b><font color="#1b9e77">C</font></b> that you think is closer to <b>A</b>.</p>

<ol>
<li>To start the experiment, click the start button below.</li>
<li>Complete each task as quickly and as accurately as possible.</li>
<li>After chosing an answer, the next task will be shown. You will not be given the opportunity to change an answer.</li>
<li>Once you completed all tasks, you can submit this HIT at the bottom of the page.</li>
</ol>

<center><button id="start" type="button" class="btn btn-danger">Start</button></center>
<fieldset><input name="start_time" type="hidden" value="" /></fieldset>

</div>
</div>
<!-- End Instructions --><!-- Content Body -->

<div id="stimuli">&nbsp;</div>
<script>

// change this to 2 or 3 for debugging
var stimuliCount = 66;

// http://www.jquerybyexample.net/2012/06/get-url-parameters-using-jquery.html
function GetURLParameter(sParam)
{
    var sPageURL = window.location.search.substring(1);
    var sURLVariables = sPageURL.split('&');
    for (var i = 0; i < sURLVariables.length; i++) 
    {
        var sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] == sParam) 
        {
            return sParameterName[1];
        }
    }
}

function checkCount() {
  var answered = $("input:checked").length;
  if (answered >= stimuliCount) {
    $("#submitButton").show();
  }
}

function setCookie() {
var studyName="pointDistances20160105";//replace this value with a unique, acceptable cookie name... no spaces and stick with alphanumerics and underscores
   $("#submitButton").click(function(){
	  var exdate=new Date();
	  exdate.setDate(exdate.getDate() + 365);
      document.cookie=studyName+"=1; expires="+exdate.toUTCString()+"; domain=mturkcontent.com; path=/";//When the user clicks the Submit button, it creates a cookie that you can read later as having already completed this survey
   });
   var i,x,y,ARRcookies=document.cookie.split(";");//variables necessary to read the cookies. Last variables separates all available cookie names into an array we will loop through to find our cookie
   for (i=0;i<ARRcookies.length;i++){
      x=ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));//x=cookie name
      y=ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1);//y=cookie value
      x=x.replace(/^\s+|\s+$/g,"");//Remove white space
      if (x==studyName && y==1){
		 //If your cookie exists AND the value is 1, they have taken your survey before.
		 //Here you would put code that somehow prevents them from doing anything for your HIT, like not loading content etc.
		 //However, for our purposes here, I just put a simple alert in. Change this to whatever code works for you.
         alert("You are not eligible for this HIT because you have already completed an identical HIT.");
      }
   }
}

//http://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array
function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    // And swap it with the current element.
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }

  return array;
}

// Returns a random integer between min (included) and max (excluded)
// Using Math.round() will give you a non-uniform distribution!
function getRandomInt(min, max) {
  return Math.floor(Math.random() * (max - min)) + min;
}

$(document).ready(function () {
  var i, id, legend_url, url;
  var stimuli = [];
  var base_url = 'https://parallelcoordinates.de/mturk/';

  var assignmentId = GetURLParameter('assignmentId');
  // console.log(assignmentId);
  if (assignmentId === "ASSIGNMENT_ID_NOT_AVAILABLE") {
    stimuliCount = 1;

  } else {
    $("#submitButton").hide();
    $("#start").prop('disabled', true);
  }

  // create random order of stimuli
  for (i = 1; i <= stimuliCount; i++) {
    stimuli.push(i);
  }

  stimuli = shuffle(stimuli);

  for (i = 1; i <= stimuliCount; i++) {
    id = stimuli[i - 1];

    // random stimuli for preview
    if (assignmentId === "ASSIGNMENT_ID_NOT_AVAILABLE") {
       id = getRandomInt(1,67);
    }

    if (id % 2) {
      legend_url = 'https://parallelcoordinates.de/mturk/legend_Parallel.png';
      url = base_url + id + '_Parallel.png';
    } else {
      legend_url = 'https://parallelcoordinates.de/mturk/legend_Cartesian.png';
      url = base_url + id + '_Cartesian.png';
    }

    $('#stimuli').append('<section id="' + i + '"><center><table><tr><td><img alt="' + id + '" height="500" src="' + url + '" width="800" /></td><td style="text-align:left;"><img src="'+legend_url+'" alt="2dC" style="height:100px;"></td></tr></table></center><fieldset><label>Which of the points <font color="#d95f02">B</font> or <font color="#1b9e77">C</font> do you think is closer to <b>A</b>?</label><div class="radio"><label><input name="' + id + '" type="radio" value="B" /><font color="#d95f02"><b>B</b></font></label></div><div class="radio"><label><input name="' + id + '" type="radio" value="C" /><font color="#1b9e77"><b>C</b></font></label></div><div class="radio"><label><input name="' + id + '" type="radio" value="equal" />Both points are equally distant from <b>A</b></label></div><input name="' + id + '_time" type="hidden" value="" /><hr></fieldset></section>');
  }

  if (assignmentId !== "ASSIGNMENT_ID_NOT_AVAILABLE") {
      // enable start button once all images have been loaded
    $('#stimuli').imagesLoaded().done(function() {
      console.log('image loaded');
      $("#start").prop('disabled', false);
    });

    $('input:radio').on('change', checkCount);
    $('input:radio').on('change', function() {
      var section = $(this).parent().parent().parent().parent();
      var current = section.attr('id');
      var next = parseInt(current) + 1;

      // hide current and show next section
      section.hide();
      $('section[id="'+next+'"]').show();

      // scroll to next section
      location.href = "#" + next;

      // set timestamp for current section
      var timestamp = new Date().getTime();
      section.find("input[type='hidden']").val(timestamp);
    });

    // $('input:radio').attr('disabled', 'disabled');
    $('section[id!="Other"]').hide();

    $('#start').click(function() {
      var timestamp = new Date().getTime();
      $("input[name='start_time']").val(timestamp);
      $('section[id="1"]').show();
      location.href = "#" + 1;
      $("#start").prop('disabled', true);
    });
  }
  
});

</script>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<hr />
<center>
<p><b>Thank you for participating in this study.</b>Please click the submit button below to complete the HIT.</p>
</center>
<!-- End Content Body --></div>
</section>
<!-- close container -->
<style type="text/css">fieldset { padding: 10px; background:#fbfbfb; border-radius:5px; margin-bottom:5px; }
</style>
